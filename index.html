<!doctype html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TPN Calculator - Pediatric | ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏®‡∏£‡∏µ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      font-family: 'Sarabun', 'Inter', sans-serif;
    }
    
    .gradient-header {
      background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #3d7ab5 100%);
    }
    
    .card-shadow {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .input-focus:focus {
      outline: none;
      ring: 2px;
      ring-color: #3b82f6;
      border-color: #3b82f6;
    }
    
    .section-title {
      position: relative;
      padding-left: 12px;
    }
    
    .section-title::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, #3b82f6, #1d4ed8);
      border-radius: 2px;
    }
    
    .result-highlight {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border-left: 4px solid #0ea5e9;
    }
    
    .warning-box {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-left: 4px solid #f59e0b;
    }
    
    .success-box {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border-left: 4px solid #10b981;
    }
    
    .table-header {
      background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
    }
    
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    input[type="number"] {
      -moz-appearance: textfield;
    }
    
    .radio-custom:checked + label {
      background-color: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    
    .checkbox-custom:checked + label {
      background-color: #10b981;
      color: white;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in {
      animation: fadeIn 0.3s ease-out forwards;
    }
    
    .print-section {
      display: none;
    }
    
    @media print {
      .no-print {
        display: none !important;
      }
      .print-section {
        display: block !important;
      }
      body {
        font-size: 12pt;
      }
    }

    .tab-button {
      transition: all 0.3s ease;
    }

    .tab-button.active {
      background-color: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }

    .tab-button.inactive {
      background-color: white;
      color: #6b7280;
      border-color: #e5e7eb;
    }

    .page-hidden {
      display: none !important;
    }
  </style>
</head>
<body class="h-full bg-gray-50">
  <div id="app" class="h-full overflow-auto">
    <!-- Header -->
    <header class="gradient-header text-white py-4 px-6 sticky top-0 z-50 shadow-lg no-print">
      <div class="max-w-6xl mx-auto flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14h-2v-4H6v-2h4V7h2v4h4v2h-4v4z"/>
            </svg>
          </div>
          <div>
            <h1 id="appTitle" class="text-xl font-bold tracking-tight">TPN Calculator - Pediatric</h1>
            <p id="hospitalName" class="text-blue-100 text-sm">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏®‡∏£‡∏µ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <button id="historyBtn" onclick="goToHistory()" class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all text-sm font-medium backdrop-blur-sm">
            üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á TPN
          </button>
          <button onclick="resetForm()" class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all text-sm font-medium backdrop-blur-sm">
            üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
          </button>
          <button onclick="window.print()" class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all text-sm font-medium backdrop-blur-sm">
            üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main id="mainContent" class="max-w-6xl mx-auto p-4 md:p-6 space-y-6">
      <!-- Order Date & Patient Info -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà Order TPN</label>
            <input type="date" id="orderDate" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all bg-white">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">HN (‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏î‡πâ)</label>
            <input type="text" id="hn" placeholder="‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå HN" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" autofocus>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
            <input type="text" id="patientName" placeholder="‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Ward</label>
            <input type="text" id="ward" placeholder="‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all">
          </div>
        </div>
      </section>

      <!-- Route Selection -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">ü©∫ Route ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ TPN</h2>
        <div class="flex flex-wrap gap-3">
          <input type="radio" name="route" id="central" value="central" class="hidden radio-custom" checked>
          <label for="central" class="px-6 py-3 border-2 border-gray-300 rounded-xl cursor-pointer transition-all hover:border-blue-400 font-medium flex items-center gap-2">
            <span class="text-xl">üîµ</span> Central Line
          </label>
          <input type="radio" name="route" id="peripheral" value="peripheral" class="hidden radio-custom">
          <label for="peripheral" class="px-6 py-3 border-2 border-gray-300 rounded-xl cursor-pointer transition-all hover:border-blue-400 font-medium flex items-center gap-2">
            <span class="text-xl">üü¢</span> Peripheral Line
          </label>
        </div>
      </section>

      <!-- Basic Info -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">‚öñÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (BW)</label>
            <div class="relative">
              <input type="number" id="bw" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12" inputmode="decimal" oninput="calculateAll()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">kg</span>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Total TPN Volume (‡∏£‡∏ß‡∏° Fat)</label>
            <div class="relative">
              <input type="number" id="totalVolume" step="1" min="0" placeholder="0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12" inputmode="decimal" oninput="calculateAll()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Fat Configuration -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üßà ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ Fat</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Fat ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ</label>
            <div class="relative">
              <input type="number" id="fatTarget" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-24" inputmode="decimal" oninput="calculateAll()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm">g/kg/day</span>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Net Fat ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</label>
            <div class="relative">
              <input type="number" id="netFat" step="0.1" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-blue-50 pr-24 font-semibold text-blue-700" readonly inputmode="decimal">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm">g/kg/day</span>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Fat Volume</label>
            <div class="relative">
              <input type="number" id="fatVolume" step="0.1" min="0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12" inputmode="decimal" oninput="calculateAll()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml</span>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Vitalipid-N Infant</label>
            <div class="relative">
              <input type="number" id="vitalipid" step="0.1" min="0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12" inputmode="decimal" oninput="calculateAll()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml</span>
            </div>
          </div>
        </div>
        <div class="flex items-center gap-3 p-3 bg-amber-50 rounded-xl border border-amber-200">
          <input type="checkbox" id="deductVitalipid" class="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer" onchange="calculateAll()">
          <label for="deductVitalipid" class="text-sm text-gray-700 cursor-pointer select-none">
            <span class="font-medium">‡∏´‡∏±‡∏Å Fat ‡∏à‡∏≤‡∏Å Vitalipid</span>
            <span class="text-amber-600">(0.4 g/kg/day)</span>
          </label>
        </div>
      </section>

      <!-- PN Volume & Rate -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üíß PN Volume & Rate</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">PN Volume (Total - Fat - Vitalipid)</label>
            <div class="relative">
              <input type="number" id="pnVolume" step="0.1" min="0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12 bg-green-50 font-semibold text-green-700" inputmode="decimal" oninput="calculateAll()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml</span>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Rate TPN (PN Volume √∑ 24)</label>
            <div class="relative">
              <input type="number" id="rateTPN" step="0.01" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-blue-50 pr-16 font-semibold text-blue-700" readonly inputmode="decimal">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml/hr</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Macronutrient -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">ü•ó Macronutrient</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Protein</label>
            <div class="relative">
              <input type="number" id="proteinTarget" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-24" inputmode="decimal" oninput="calculateAll()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm">g/kg/day</span>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Fat (Net Fat)</label>
            <div class="relative">
              <input type="number" id="fatDisplay" step="0.1" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-100 pr-24 font-semibold text-gray-600" readonly inputmode="decimal">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm">g/kg/day</span>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">%Dextrose</label>
            <div class="relative">
              <input type="number" id="dextrosePercent" step="0.1" min="0" max="50" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12" inputmode="decimal" oninput="calculateAll()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">%</span>
            </div>
          </div>
        </div>
        <div id="girContainer" class="p-4 rounded-xl result-highlight">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <span class="text-2xl">üìä</span>
              <div>
                <span class="text-sm text-gray-600">GIR (Glucose Infusion Rate)</span>
                <p class="text-xs text-gray-500 mt-0.5">= (Rate TPN √ó %Dextrose) √∑ (BW √ó 6)</p>
              </div>
            </div>
            <div class="text-right">
              <span id="girValue" class="text-2xl font-bold text-blue-700">0.00</span>
              <span class="text-gray-600 ml-1">mg/kg/min</span>
            </div>
          </div>
          <div id="girWarning" class="hidden mt-2 text-sm text-amber-700 bg-amber-100 px-3 py-2 rounded-lg">
            ‚ö†Ô∏è GIR ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏õ‡∏Å‡∏ï‡∏¥ 4-6 mg/kg/min ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≤‡∏£‡∏Å, 2-4 mg/kg/min ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å‡πÇ‡∏ï)
          </div>
        </div>
      </section>

      <!-- Product Selection -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üß¨ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="p-4 bg-purple-50 rounded-xl border border-purple-200">
            <h3 class="font-semibold text-purple-800 mb-3 flex items-center gap-2"><span>ü•©</span> Protein Product</h3>
            <div class="space-y-2">
              <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-purple-100 transition-all border border-transparent hover:border-purple-300">
                <input type="radio" name="proteinProduct" value="aminoven" class="mt-1" checked onchange="calculateAll()">
                <div>
                  <span class="font-medium text-gray-800">10% Aminoven¬Æ Infant</span>
                  <p class="text-xs text-gray-500">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏¢‡∏∏ 0-1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
                </div>
              </label>
              <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-purple-100 transition-all border border-transparent hover:border-purple-300">
                <input type="radio" name="proteinProduct" value="amiparen" onchange="calculateAll()">
                <div>
                  <span class="font-medium text-gray-800">10% Amiparen¬Æ</span>
                  <p class="text-xs text-gray-500">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏¢‡∏∏ > 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
                </div>
              </label>
              <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-purple-100 transition-all border border-transparent hover:border-purple-300">
                <input type="radio" name="proteinProduct" value="aminoplasmal" onchange="calculateAll()">
                <div>
                  <span class="font-medium text-gray-800">15% Aminoplasmal¬Æ</span>
                  <p class="text-xs text-gray-500">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô‡∏™‡∏π‡∏á (‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤)</p>
                </div>
              </label>
            </div>
          </div>
          <div class="p-4 bg-amber-50 rounded-xl border border-amber-200">
            <h3 class="font-semibold text-amber-800 mb-3 flex items-center gap-2"><span>üßà</span> Fat Product</h3>
            <div class="space-y-2">
              <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-amber-100 transition-all border border-transparent hover:border-amber-300">
                <input type="radio" name="fatProduct" value="smof" class="mt-1" checked onchange="calculateAll()">
                <div>
                  <span class="font-medium text-gray-800">20% SMOF Lipid</span>
                  <p class="text-xs text-gray-500">Mixed lipid emulsion</p>
                </div>
              </label>
              <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-amber-100 transition-all border border-transparent hover:border-amber-300">
                <input type="radio" name="fatProduct" value="intralipid" onchange="calculateAll()">
                <div>
                  <span class="font-medium text-gray-800">20% Intralipid</span>
                  <p class="text-xs text-gray-500">Soybean oil emulsion</p>
                </div>
              </label>
            </div>
          </div>
        </div>
      </section>

      <!-- Electrolytes Section -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">‚öóÔ∏è Electrolytes</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">P (Glycophos¬Æ)</label>
            <p class="text-xs text-gray-600 mb-2">0.5-1 mEq/kg/day</p>
            <div class="relative mb-2">
              <input type="number" id="phosphorus" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="calculateAll()">
            </div>
            <div class="text-xs bg-blue-50 p-2 rounded-lg border border-blue-200">
              <p class="text-gray-700"><strong>Vol:</strong> <span id="phosvol">0.0</span> ml</p>
              <p class="text-gray-700"><strong>Na from P:</strong> <span id="phoNa">0</span> mEq</p>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Na (3% NaCl)</label>
            <p class="text-xs text-gray-600 mb-2">2-4 mEq/kg/day</p>
            <div class="relative mb-2">
              <input type="number" id="sodium" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="calculateAll()">
            </div>
            <div class="text-xs bg-blue-50 p-2 rounded-lg border border-blue-200">
              <p class="text-gray-700"><strong>Vol:</strong> <span id="navol">0.0</span> ml</p>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">K (KCl)</label>
            <p class="text-xs text-gray-600 mb-2">2-4 mEq/kg/day</p>
            <div class="relative mb-2">
              <input type="number" id="potassium" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="calculateAll()">
            </div>
            <div class="text-xs bg-blue-50 p-2 rounded-lg border border-blue-200">
              <p class="text-gray-700"><strong>Vol:</strong> <span id="kvol">0.0</span> ml</p>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Mg (50% MgSO‚ÇÑ)</label>
            <p class="text-xs text-gray-600 mb-2">0.2-0.3 mmol/kg/day</p>
            <div class="relative mb-2">
              <input type="number" id="magnesium" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="calculateAll()">
            </div>
            <div class="text-xs bg-blue-50 p-2 rounded-lg border border-blue-200">
              <p class="text-gray-700"><strong>Vol:</strong> <span id="mgvol">0.0</span> ml</p>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Ca (10% Ca Gluconate)</label>
            <p class="text-xs text-gray-600 mb-2">4-6 ml/kg/day</p>
            <div class="relative mb-2">
              <input type="number" id="calcium" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="calculateAll()">
            </div>
            <div class="text-xs bg-blue-50 p-2 rounded-lg border border-blue-200">
              <p class="text-gray-700"><strong>Vol:</strong> <span id="cavol">0.0</span> ml</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Vitamins & Trace Elements Section -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üíä Vitamin & Trace Elements</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="p-4 bg-green-50 rounded-xl border border-green-200">
            <h3 class="font-semibold text-green-800 mb-3">üíâ Vitamin</h3>
            <div class="space-y-3">
              <div>
                <label class="text-sm font-medium text-gray-700 block mb-1">Soluvit¬Æ N</label>
                <div class="flex items-center gap-2">
                  <input type="number" id="soluvit" step="0.1" class="flex-1 px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" readonly inputmode="decimal">
                  <span class="text-gray-600 whitespace-nowrap font-medium">ml</span>
                </div>
                <p class="text-xs text-gray-600 mt-1">= 1 √ó BW (Max 10 ml)</p>
                <p id="soluvitWarning" class="hidden text-xs text-red-600 mt-1 font-semibold">‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏ô 10 ml!</p>
              </div>
            </div>
          </div>
          <div class="p-4 bg-cyan-50 rounded-xl border border-cyan-200">
            <h3 class="font-semibold text-cyan-800 mb-3">üî¨ Trace Elements</h3>
            <div class="space-y-3">
              <div>
                <label class="text-sm font-medium text-gray-700 block mb-1">Peditrace¬Æ</label>
                <div class="flex items-center gap-2">
                  <input type="number" id="peditrace" step="0.1" class="flex-1 px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" readonly inputmode="decimal">
                  <span class="text-gray-600 whitespace-nowrap font-medium">ml</span>
                </div>
                <p class="text-xs text-gray-600 mt-1">= 1 √ó BW (Max 15 ml)</p>
                <p id="peditraceWarning" class="hidden text-xs text-red-600 mt-1 font-semibold">‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏ô 15 ml!</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Additive Section -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üß™ Additive</h2>
        <div class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="p-4 bg-orange-50 rounded-xl border border-orange-200">
              <h3 class="font-semibold text-orange-800 mb-3 flex items-center gap-2">
                <input type="checkbox" id="isPreterm" class="w-5 h-5 rounded cursor-pointer" onchange="calculateAll()">
                <label for="isPreterm" class="cursor-pointer">Preterm infant</label>
              </h3>
              <div id="zincOptions" class="space-y-3 hidden">
                <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-orange-100 border border-transparent hover:border-orange-300">
                  <input type="radio" name="zinc" value="yes" class="mt-1" onchange="calculateAll()">
                  <div class="flex-1">
                    <span class="font-medium text-gray-800 block">Add Zinc Sulfate</span>
                    <p class="text-xs text-gray-600">500 mcg/ml = 0.3 ml √ó BW</p>
                  </div>
                </label>
                <div id="zincVolumeDiv" class="hidden ml-8 p-3 bg-white rounded-lg">
                  <label class="block text-sm font-medium text-gray-700 mb-2">Zinc Volume</label>
                  <div class="relative">
                    <input type="number" id="zincVolume" step="0.01" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="calculateAll()">
                    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm">ml</span>
                  </div>
                </div>
                <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-orange-100 border border-transparent hover:border-orange-300">
                  <input type="radio" name="zinc" value="no" class="mt-1" onchange="calculateAll()">
                  <span class="font-medium text-gray-800">‡πÑ‡∏°‡πà‡πÄ‡∏ï‡∏¥‡∏° Zinc</span>
                </label>
              </div>
            </div>
            <div class="p-4 bg-pink-50 rounded-xl border border-pink-200">
              <h3 class="font-semibold text-pink-800 mb-3">üíâ Heparin</h3>
              <div class="space-y-3">
                <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-pink-100 border border-transparent hover:border-pink-300">
                  <input type="radio" name="heparin" value="yes" id="heparinYes" class="mt-1" onchange="calculateAll()">
                  <div class="flex-1">
                    <span class="font-medium text-gray-800 block">‡πÄ‡∏ï‡∏¥‡∏° Heparin</span>
                    <p class="text-xs text-gray-600">1 unit/ml = 1 √ó PN volume</p>
                  </div>
                </label>
                <div id="heparinValueDiv" class="hidden ml-8 p-3 bg-white rounded-lg">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="text-sm font-medium text-gray-700">Heparin Units:</span>
                    <span id="heparinUnits" class="text-lg font-bold text-pink-700">0</span>
                    <span class="text-gray-600">units</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-sm font-medium text-gray-700">Heparin Volume:</span>
                    <span id="heparinVolume" class="text-lg font-bold text-pink-700">0.00</span>
                    <span class="text-gray-600">ml (√∑ 500)</span>
                  </div>
                </div>
                <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-pink-100 border border-transparent hover:border-pink-300">
                  <input type="radio" name="heparin" value="no" class="mt-1" checked onchange="calculateAll()">
                  <span class="font-medium text-gray-800">‡πÑ‡∏°‡πà‡πÄ‡∏ï‡∏¥‡∏° Heparin</span>
                </label>
              </div>
            </div>
          </div>
          <div class="p-4 bg-purple-50 rounded-xl border border-purple-200">
            <h3 class="font-semibold text-purple-800 mb-3">‚ûï Add ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£</label>
                <input type="text" id="additiveOtherName" placeholder="‡πÄ‡∏ä‡πà‡∏ô Taurine, L-Carnitine" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" oninput="calculateAll()">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£</label>
                <div class="relative">
                  <input type="number" id="additiveOtherVolume" step="0.1" min="0" placeholder="0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12" inputmode="decimal" oninput="calculateAll()">
                  <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Composition Table -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üìä ‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö TPN</h2>
        <div class="overflow-x-auto rounded-xl border border-gray-200">
          <table class="w-full text-sm">
            <thead>
              <tr class="table-header text-white">
                <th class="px-4 py-3 text-left font-semibold rounded-tl-xl">‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</th>
                <th class="px-4 py-3 text-right font-semibold">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£ (ml)</th>
                <th class="px-4 py-3 text-right font-semibold">‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà (kcal)</th>
                <th class="px-4 py-3 text-right font-semibold rounded-tr-xl">mOsmol/L</th>
              </tr>
            </thead>
            <tbody id="compositionTable">
              <tr class="border-b border-gray-100 hover:bg-gray-50">
                <td class="px-4 py-3 font-medium text-purple-700">ü•© Protein</td>
                <td id="proteinVol" class="px-4 py-3 text-right font-mono">0.0</td>
                <td id="proteinCal" class="px-4 py-3 text-right font-mono">0.0</td>
                <td id="proteinOsmol" class="px-4 py-3 text-right font-mono">0</td>
              </tr>
              <tr class="border-b border-gray-100 hover:bg-gray-50 bg-blue-50/50">
                <td class="px-4 py-3 font-medium text-blue-700">üç¨ 50% Dextrose</td>
                <td id="dextroseVol" class="px-4 py-3 text-right font-mono">0.0</td>
                <td id="dextroseCal" class="px-4 py-3 text-right font-mono">0.0</td>
                <td id="dextroseOsmol" class="px-4 py-3 text-right font-mono">0</td>
              </tr>
              <tr class="border-b border-gray-100 hover:bg-gray-50">
                <td class="px-4 py-3 font-medium text-amber-700">üßà Fat 20%</td>
                <td id="fatVol" class="px-4 py-3 text-right font-mono">0.0</td>
                <td id="fatCal" class="px-4 py-3 text-right font-mono">0.0</td>
                <td class="px-4 py-3 text-right text-gray-400">-</td>
              </tr>
              <tr class="border-b border-gray-100 hover:bg-gray-50">
                <td class="px-4 py-3 font-medium text-red-700">üßÇ Electrolytes</td>
                <td id="electrolytesVol" class="px-4 py-3 text-right font-mono">0.0</td>
                <td class="px-4 py-3 text-right text-gray-400">-</td>
                <td id="electrolytesOsmol" class="px-4 py-3 text-right font-mono">0</td>
              </tr>
              <tr class="border-b border-gray-100 hover:bg-gray-50">
                <td class="px-4 py-3 font-medium text-green-700">üíä Vitamins & Trace</td>
                <td id="vitaminTraceVol" class="px-4 py-3 text-right font-mono">0.0</td>
                <td class="px-4 py-3 text-right text-gray-400">-</td>
                <td class="px-4 py-3 text-right text-gray-400">-</td>
              </tr>
              <tr class="border-b border-gray-100 hover:bg-gray-50">
                <td class="px-4 py-3 font-medium text-indigo-700">üß™ Additives</td>
                <td id="additivesVol" class="px-4 py-3 text-right font-mono">0.0</td>
                <td class="px-4 py-3 text-right text-gray-400">-</td>
                <td class="px-4 py-3 text-right text-gray-400">-</td>
              </tr>
              <tr class="border-b border-gray-100 hover:bg-gray-50 bg-green-50/50">
                <td class="px-4 py-3 font-medium text-green-700">üíß Sterile Water</td>
                <td id="waterVol" class="px-4 py-3 text-right font-mono">0.0</td>
                <td class="px-4 py-3 text-right text-gray-400">-</td>
                <td class="px-4 py-3 text-right text-gray-400">-</td>
              </tr>
              <tr class="bg-gray-100 font-bold">
                <td class="px-4 py-3 text-gray-800">‡∏£‡∏ß‡∏° (PN bag)</td>
                <td id="totalPNVol" class="px-4 py-3 text-right font-mono text-blue-700">0.0</td>
                <td id="totalPNCal" class="px-4 py-3 text-right font-mono text-green-700">0.0</td>
                <td id="totalOsmol" class="px-4 py-3 text-right font-mono text-purple-700">0</td>
              </tr>
              <tr class="bg-amber-50">
                <td class="px-4 py-3 font-medium text-amber-700">+ Fat Volume</td>
                <td id="totalFatVol" class="px-4 py-3 text-right font-mono">0.0</td>
                <td id="totalFatCal" class="px-4 py-3 text-right font-mono">0.0</td>
                <td class="px-4 py-3 text-right text-gray-400">-</td>
              </tr>
              <tr class="bg-gradient-to-r from-blue-100 to-green-100 font-bold text-lg">
                <td class="px-4 py-4 text-gray-800 rounded-bl-xl">üéØ Total TPN</td>
                <td id="grandTotalVol" class="px-4 py-4 text-right font-mono text-blue-700">0.0</td>
                <td id="grandTotalCal" class="px-4 py-4 text-right font-mono text-green-700">0.0</td>
                <td class="px-4 py-4 text-right font-mono text-purple-700 rounded-br-xl">-</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="p-4 bg-green-50 rounded-xl border border-green-200">
            <div class="text-sm text-green-600 mb-1">Total Calories</div>
            <div class="flex items-baseline gap-2">
              <span id="totalCalDisplay" class="text-2xl font-bold text-green-700">0.0</span>
              <span class="text-green-600">kcal/day</span>
            </div>
          </div>
          <div class="p-4 bg-blue-50 rounded-xl border border-blue-200">
            <div class="text-sm text-blue-600 mb-1">Calories per kg</div>
            <div class="flex items-baseline gap-2">
              <span id="calPerKg" class="text-2xl font-bold text-blue-700">0.0</span>
              <span class="text-blue-600">kcal/kg/day</span>
            </div>
          </div>
          <div class="p-4 bg-purple-50 rounded-xl border border-purple-200">
            <div class="text-sm text-purple-600 mb-1">Final Osmolarity</div>
            <div class="flex items-baseline gap-2">
              <span id="finalOsmol" class="text-2xl font-bold text-purple-700">0</span>
              <span class="text-purple-600">mOsmol/L</span>
            </div>
          </div>
        </div>
        <div id="osmolWarning" class="hidden mt-4 p-4 warning-box rounded-xl">
          <div class="flex items-center gap-2 text-amber-800">
            <span class="text-xl">‚ö†Ô∏è</span>
            <span class="font-medium">Osmolarity ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Peripheral Line (> 900 mOsmol/L) ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏ä‡πâ Central Line</span>
          </div>
        </div>
      </section>

      <!-- Fat Administration -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üíâ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ Fat</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏≤‡∏£‡πÑ‡∏•‡πà‡∏™‡∏≤‡∏¢</label>
            <div class="space-y-2">
              <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                <input type="radio" name="flush" value="none" checked onchange="calculateFatAdmin()">
                <span class="text-sm">‡πÑ‡∏°‡πà‡πÑ‡∏•‡πà‡∏™‡∏≤‡∏¢</span>
              </label>
              <div class="flex items-center gap-2">
                <input type="radio" name="flush" value="custom" onchange="calculateFatAdmin()">
                <span class="text-sm">+</span>
                <input type="number" id="flushVolume" min="0" step="1" placeholder="0" class="w-20 px-2 py-1 border border-gray-300 rounded-lg text-sm" inputmode="decimal" oninput="calculateFatAdmin()">
                <span class="text-sm text-gray-600">ml ‡πÑ‡∏•‡πà‡∏™‡∏≤‡∏¢</span>
              </div>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">IV drip in</label>
            <div class="space-y-2">
              <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                <input type="radio" name="dripDuration" value="12" checked onchange="calculateFatAdmin()">
                <span class="text-sm">12 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</span>
              </label>
              <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                <input type="radio" name="dripDuration" value="24" onchange="calculateFatAdmin()">
                <span class="text-sm">24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</span>
              </label>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°</label>
            <div class="space-y-2">
              <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                <input type="radio" name="prepSplit" value="none" checked onchange="calculateFatAdmin()">
                <span class="text-sm">‡πÑ‡∏°‡πà‡πÅ‡∏ö‡πà‡∏á</span>
              </label>
              <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                <input type="radio" name="prepSplit" value="split" onchange="calculateFatAdmin()">
                <span class="text-sm">‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°</span>
              </label>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Fat Rate</label>
            <div id="fatRateContainer" class="p-3 bg-blue-50 rounded-xl border border-blue-200">
              <div class="text-2xl font-bold text-blue-700" id="fatRateValue">0.0</div>
              <div class="text-xs text-blue-600">g/kg/hr</div>
            </div>
          </div>
        </div>
        <div id="fatRateWarning" class="hidden p-3 warning-box rounded-xl text-sm">
          <span class="font-medium">‚ö†Ô∏è Fat Rate ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ!</span> ‡∏Ñ‡∏ß‡∏£ ‚â§ 0.11 g/kg/hr ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏†‡∏≤‡∏ß‡∏∞‡πÅ‡∏ó‡∏£‡∏Å‡∏ã‡πâ‡∏≠‡∏ô
        </div>
        <div id="prepSummary" class="mt-4 p-4 success-box rounded-xl">
          <h4 class="font-semibold text-green-800 mb-2">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Fat</h4>
          <div id="prepDetails" class="text-green-700"></div>
        </div>
      </section>

      <!-- Summary Section -->
      <section class="bg-gradient-to-br from-blue-600 to-blue-800 rounded-2xl card-shadow p-6 text-white animate-fade-in">
        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <span class="text-2xl">üìã</span> ‡∏™‡∏£‡∏∏‡∏õ TPN Order
        </h2>
        <div id="orderSummary" class="space-y-3 text-blue-100">
          <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ Order</p>
        </div>
      </section>

      <!-- Save Order Button -->
      <div class="flex gap-2 justify-end mb-6">
        <button onclick="goToHistory()" class="px-6 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition-all">
          ‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
        </button>
        <button id="saveOrderBtn" onclick="saveOrder()" class="px-6 py-3 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-700 transition-all flex items-center gap-2">
          <span>üíæ</span> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Order
        </button>
      </div>
    </main>

    <!-- History Page -->
    <div id="historyPage" class="page-hidden h-full overflow-auto">
      <header class="gradient-header text-white py-4 px-6 sticky top-0 z-50 shadow-lg no-print">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
              <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
              </svg>
            </div>
            <div>
              <h1 class="text-xl font-bold tracking-tight">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á TPN</h1>
              <p class="text-blue-100 text-sm">Order History</p>
            </div>
          </div>
          <button onclick="goToCalculator()" class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all text-sm font-medium backdrop-blur-sm">
            ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
          </button>
        </div>
      </header>

      <main class="max-w-6xl mx-auto p-4 md:p-6 space-y-6">
        <!-- Filter Section -->
        <section class="bg-white rounded-2xl card-shadow p-6">
          <h2 class="text-lg font-semibold text-gray-800 mb-4">üîç ‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 items-end">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Å‡∏£‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
              <input type="date" id="filterDate" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ HN:</label>
              <input type="text" id="searchHN" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå HN" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</label>
              <input type="text" id="searchName" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all">
            </div>
            <button onclick="filterHistory()" class="px-6 py-2.5 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition-all flex items-center gap-2 justify-center">
              <span>üîç</span> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            </button>
          </div>
        </section>

        <!-- Tab Buttons -->
        <section class="bg-white rounded-2xl card-shadow p-4">
          <div class="flex flex-wrap gap-2">
            <button onclick="filterByTab('today')" class="tab-button active px-6 py-2 border-2 rounded-lg font-medium transition-all">
              üìÖ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            </button>
            <button onclick="filterByTab('yesterday')" class="tab-button inactive px-6 py-2 border-2 rounded-lg font-medium transition-all">
              üìÖ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô
            </button>
            <button onclick="filterByTab('all')" class="tab-button inactive px-6 py-2 border-2 rounded-lg font-medium transition-all">
              üìÖ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
          </div>
        </section>

        <!-- Order List -->
        <section id="historyList" class="bg-white rounded-2xl card-shadow p-6">
          <div id="orderListContainer" class="space-y-4">
            <p class="text-gray-500 text-center py-8">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
          </div>
        </section>
      </main>

      <!-- Footer -->
      <footer class="text-center py-6 text-gray-500 text-sm">
        <p>TPN Calculator for Pediatric Patients</p>
      </footer>
    </div>

    <!-- Order Detail Modal -->
    <div id="detailModal" class="fixed inset-0 bg-black/50 z-[9999] hidden overflow-auto">
      <div class="min-h-screen py-6 px-4 flex items-center justify-center">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-auto shadow-2xl">
          <div class="gradient-header text-white p-6 sticky top-0 z-50 flex items-center justify-between">
            <div>
              <h2 class="text-2xl font-bold">üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î TPN Order</h2>
              <p id="detailPatientInfo" class="text-blue-100 text-sm mt-1">-</p>
            </div>
            <button onclick="closeDetail()" class="text-2xl hover:bg-white/20 p-2 rounded-lg transition-all">
              ‚úï
            </button>
          </div>
          <div id="detailContent" class="p-6 space-y-6">
            <section class="space-y-4">
              <h3 class="section-title text-lg font-semibold text-gray-800">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="p-4 bg-gray-50 rounded-xl">
                  <span class="text-xs text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà Order</span>
                  <p id="det-orderDate" class="font-semibold text-gray-800 mt-1">-</p>
                </div>
                <div class="p-4 bg-gray-50 rounded-xl">
                  <span class="text-xs text-gray-600">HN</span>
                  <p id="det-hn" class="font-semibold text-gray-800 mt-1">-</p>
                </div>
                <div class="p-4 bg-gray-50 rounded-xl">
                  <span class="text-xs text-gray-600">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</span>
                  <p id="det-patientName" class="font-semibold text-gray-800 mt-1">-</p>
                </div>
                <div class="p-4 bg-gray-50 rounded-xl">
                  <span class="text-xs text-gray-600">Ward</span>
                  <p id="det-ward" class="font-semibold text-gray-800 mt-1">-</p>
                </div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="p-4 bg-blue-50 rounded-xl border border-blue-200">
                  <span class="text-xs text-blue-600">Route</span>
                  <p id="det-route" class="font-semibold text-blue-700 mt-1">-</p>
                </div>
                <div class="p-4 bg-green-50 rounded-xl border border-green-200">
                  <span class="text-xs text-green-600">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (BW)</span>
                  <p id="det-bw" class="font-semibold text-green-700 mt-1">-</p>
                </div>
                <div class="p-4 bg-purple-50 rounded-xl border border-purple-200">
                  <span class="text-xs text-purple-600">PN Volume</span>
                  <p id="det-pnVolume" class="font-semibold text-purple-700 mt-1">-</p>
                </div>
              </div>
            </section>

            <section class="space-y-4">
              <h3 class="section-title text-lg font-semibold text-gray-800">ü•ó Macronutrient</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="p-4 bg-purple-50 rounded-xl border border-purple-200">
                  <span class="text-xs text-purple-600">Protein</span>
                  <p id="det-protein" class="font-semibold text-purple-700 mt-1">-</p>
                </div>
                <div class="p-4 bg-amber-50 rounded-xl border border-amber-200">
                  <span class="text-xs text-amber-600">Net Fat</span>
                  <p id="det-netFat" class="font-semibold text-amber-700 mt-1">-</p>
                </div>
                <div class="p-4 bg-blue-50 rounded-xl border border-blue-200">
                  <span class="text-xs text-blue-600">Dextrose %</span>
                  <p id="det-dextrose" class="font-semibold text-blue-700 mt-1">-</p>
                </div>
                <div class="p-4 bg-red-50 rounded-xl border border-red-200">
                  <span class="text-xs text-red-600">GIR</span>
                  <p id="det-gir" class="font-semibold text-red-700 mt-1">-</p>
                </div>
              </div>
            </section>

            <section class="space-y-4">
              <h3 class="section-title text-lg font-semibold text-gray-800">üî• Calories</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="p-4 bg-green-50 rounded-xl border border-green-200">
                  <span class="text-xs text-green-600">Total Calories</span>
                  <p id="det-totalCalories" class="text-2xl font-bold text-green-700 mt-1">-</p>
                  <span class="text-xs text-green-600">kcal/day</span>
                </div>
                <div class="p-4 bg-green-50 rounded-xl border border-green-200">
                  <span class="text-xs text-green-600">Calories per kg</span>
                  <p id="det-calPerKg" class="text-2xl font-bold text-green-700 mt-1">-</p>
                  <span class="text-xs text-green-600">kcal/kg/day</span>
                </div>
              </div>
            </section>

            <section class="space-y-4">
              <h3 class="section-title text-lg font-semibold text-gray-800">üíß Rate & Volume</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="p-4 bg-cyan-50 rounded-xl border border-cyan-200">
                  <span class="text-xs text-cyan-600">Rate TPN</span>
                  <p id="det-rateTPN" class="font-semibold text-cyan-700 mt-1">-</p>
                </div>
                <div class="p-4 bg-indigo-50 rounded-xl border border-indigo-200">
                  <span class="text-xs text-indigo-600">Fat Rate</span>
                  <p id="det-fatRate" class="font-semibold text-indigo-700 mt-1">-</p>
                </div>
                <div class="p-4 bg-pink-50 rounded-xl border border-pink-200">
                  <span class="text-xs text-pink-600">Vitalipid Volume</span>
                  <p id="det-vitalipid" class="font-semibold text-pink-700 mt-1">-</p>
                </div>
              </div>
            </section>

            <div class="flex gap-2 justify-end pt-4 border-t border-gray-200">
              <button onclick="printDetail()" class="px-6 py-2.5 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition-all">
                üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå
              </button>
              <button onclick="closeDetail()" class="px-6 py-2.5 bg-gray-300 text-gray-800 font-semibold rounded-xl hover:bg-gray-400 transition-all">
                ‡∏õ‡∏¥‡∏î
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-6 text-gray-500 text-sm no-print">
      <p>TPN Calculator for Pediatric Patients</p>
      <p class="mt-1">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏®‡∏£‡∏µ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå | ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
    </footer>
  </div>

  <script>
   // ========================================
    // TPN Calculator Logic & API Integration
    // ========================================
    
    const API_URL = 'https://script.google.com/macros/s/AKfycbznohxTrX1isy29RXdA1qgV7FhosE_Tq_vpyWhDv-zcuT_gRJmjZA4uV_vVty2v-VWN/exec';
    
    let allOrders = [];
    let currentTab = 'today';

    // 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Save Order)
    async function saveOrder() {
      const hn = document.getElementById('hn').value;
      const patientName = document.getElementById('patientName').value;
      
      if (!hn || !patientName) {
        showSaveMessage('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å HN ‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
        return;
      }

      const saveBtn = document.getElementById('saveOrderBtn');
      const originalText = saveBtn.innerHTML;
      saveBtn.disabled = true;
      saveBtn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

      // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      const orderData = {
        action: 'create',
        order_date: document.getElementById('orderDate').value,
        hn: hn,
        patient_name: patientName,
        ward: document.getElementById('ward').value,
        route: document.querySelector('input[name="route"]:checked').value,
        bw: parseFloat(document.getElementById('bw').value) || 0,
        total_volume: parseFloat(document.getElementById('totalVolume').value) || 0,
        pn_volume: parseFloat(document.getElementById('pnVolume').value) || 0,
        rate_tpn: parseFloat(document.getElementById('rateTPN').value) || 0,
        protein_target: parseFloat(document.getElementById('proteinTarget').value) || 0,
        fat_target: parseFloat(document.getElementById('fatTarget').value) || 0,
        net_fat: parseFloat(document.getElementById('netFat').value) || 0,
        dextrose_percent: parseFloat(document.getElementById('dextrosePercent').value) || 0,
        gir: parseFloat(document.getElementById('girValue').textContent) || 0,
        total_calories: parseFloat(document.getElementById('totalCalDisplay').textContent) || 0,
        cal_per_kg: parseFloat(document.getElementById('calPerKg').textContent) || 0,
        osmolarity: parseFloat(document.getElementById('finalOsmol').textContent) || 0,
        timestamp: new Date().toISOString()
      };

      try {
        const formData = new URLSearchParams();
        Object.keys(orderData).forEach(key => formData.append(key, orderData[key]));
        
        await fetch(API_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: formData.toString()
        });
        
        showSaveMessage('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Order ‡∏•‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        
        setTimeout(() => {
          resetForm();
          goToHistory();
        }, 1500);
      } catch (error) {
        console.error('Save error:', error);
        showSaveMessage('‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message, 'error');
      } finally {
        saveBtn.disabled = false;
        saveBtn.innerHTML = originalText;
      }
    }

    // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
    async function fetchAllOrders() {
      try {
        const container = document.getElementById('orderListContainer');
        container.innerHTML = '<p class="text-gray-500 text-center py-8">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥...</p>';
        
        const response = await fetch(`${API_URL}?action=read`);
        const result = await response.json();
        
        if (result.status === 'success') {
          allOrders = result.data || [];
          filterHistory();
        }
      } catch (error) {
        console.error('Fetch error:', error);
      }
    }

    // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏•‡∏±‡∏Å
    function calculateAll() {
      const bw = parseFloat(document.getElementById('bw').value) || 0;
      const totalVolume = parseFloat(document.getElementById('totalVolume').value) || 0;
      const fatTarget = parseFloat(document.getElementById('fatTarget').value) || 0;
      const deductVitalipid = document.getElementById('deductVitalipid').checked;
      const proteinTarget = parseFloat(document.getElementById('proteinTarget').value) || 0;
      const dextrosePercent = parseFloat(document.getElementById('dextrosePercent').value) || 0;
      
      let netFat = deductVitalipid ? Math.max(0, fatTarget - 0.4) : fatTarget;
      document.getElementById('netFat').value = roundToPlace(netFat, 1);
      document.getElementById('fatDisplay').value = roundToPlace(netFat, 1);
      
      const fatVolume = bw * netFat * 5;
      document.getElementById('fatVolume').value = roundToPlace(fatVolume, 1);
      
      const vitalipidVolume = bw * 4;
      document.getElementById('vitalipid').value = roundToPlace(vitalipidVolume, 1);
      
      const pnVolume = Math.max(0, totalVolume - fatVolume - vitalipidVolume);
      document.getElementById('pnVolume').value = roundToPlace(pnVolume, 1);
      
      const rateTPN = pnVolume / 24;
      document.getElementById('rateTPN').value = roundToPlace(rateTPN, 1);
      
      let gir = bw > 0 ? (rateTPN * dextrosePercent) / (bw * 6) : 0;
      document.getElementById('girValue').textContent = roundToPlace(gir, 2);
      document.getElementById('girWarning').classList.toggle('hidden', gir <= 12);

      // Electrolytes
      const phosVol = roundToPlace((parseFloat(document.getElementById('phosphorus').value) || 0) * bw, 1);
      document.getElementById('phosvol').textContent = phosVol;
      document.getElementById('phoNa').textContent = roundToPlace(phosVol * 2, 0);
      const naReq = (parseFloat(document.getElementById('sodium').value) || 0) * bw;
      document.getElementById('navol').textContent = roundToPlace(Math.max(0, naReq - (phosVol * 2)) / 0.5, 1);
      document.getElementById('kvol').textContent = roundToPlace(((parseFloat(document.getElementById('potassium').value) || 0) * bw) / 2, 1);
      document.getElementById('mgvol').textContent = roundToPlace(((parseFloat(document.getElementById('magnesium').value) || 0) * bw) / 2, 2);
      document.getElementById('cavol').textContent = roundToPlace((parseFloat(document.getElementById('calcium').value) || 0) * bw, 1);

      // Macronutrient Tables
      const protG = bw * proteinTarget;
      const dextG = (dextrosePercent * pnVolume) / 100;
      const totalCal = (protG * 4) + (dextG * 3.4) + (bw * netFat * 10);

      document.getElementById('proteinVol').textContent = roundToPlace(protG * 10, 1);
      document.getElementById('proteinCal').textContent = roundToPlace(protG * 4, 1);
      document.getElementById('dextroseVol').textContent = roundToPlace(dextG * 2, 1);
      document.getElementById('dextroseCal').textContent = roundToPlace(dextG * 3.4, 1);
      document.getElementById('fatVol').textContent = roundToPlace(fatVolume, 1);
      document.getElementById('fatCal').textContent = roundToPlace(bw * netFat * 10, 1);
      
      document.getElementById('totalCalDisplay').textContent = roundToPlace(totalCal, 1);
      document.getElementById('calPerKg').textContent = bw > 0 ? roundToPlace(totalCal / bw, 1) : '0.0';
      document.getElementById('grandTotalVol').textContent = roundToPlace(pnVolume + fatVolume + vitalipidVolume, 1);
      
      calculateFatAdmin();
      updateOrderSummary();
    }

    function roundToPlace(num, p) { return Math.round((num || 0) * Math.pow(10, p)) / Math.pow(10, p); }

    function showSaveMessage(m, t) {
      const d = document.createElement('div');
      d.className = `fixed top-4 left-1/2 -translate-x-1/2 ${t==='success'?'bg-green-500':'bg-red-500'} text-white px-6 py-3 rounded-lg shadow-lg z-[9999] animate-fade-in`;
      d.textContent = m;
      document.body.appendChild(d);
      setTimeout(() => d.remove(), 3000);
    }

    function goToHistory() {
      document.getElementById('mainContent').classList.add('page-hidden');
      document.getElementById('historyPage').classList.remove('page-hidden');
      fetchAllOrders();
    }

    function goToCalculator() {
      document.getElementById('historyPage').classList.add('page-hidden');
      document.getElementById('mainContent').classList.remove('page-hidden');
    }

    function filterByTab(t) {
      currentTab = t;
      document.querySelectorAll('.tab-button').forEach(b => b.classList.replace('active', 'inactive'));
      event.target.classList.replace('inactive', 'active');
      filterHistory();
    }

    function filterHistory() {
      const h = document.getElementById('searchHN').value.toLowerCase();
      let f = allOrders.filter(o => (o.hn || '').toString().toLowerCase().includes(h));
      displayOrderList(f);
    }

    function displayOrderList(orders) {
      const container = document.getElementById('orderListContainer');
      container.innerHTML = orders.map((o, i) => `
        <div onclick="openDetail(${i})" class="p-4 border rounded-xl hover:border-blue-400 cursor-pointer shadow-sm bg-white transition-all">
          <div class="flex justify-between items-center">
            <div>
              <span class="font-bold text-gray-800">HN: ${o.hn}</span>
              <p class="text-sm text-gray-600">${o.patient_name || '-'}</p>
            </div>
            <div class="text-right text-blue-600 font-medium">
              ${new Date(o.order_date).toLocaleDateString('th-TH')}
            </div>
          </div>
        </div>
      `).join('') || '<p class="text-center py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
      window.currentOrderList = orders;
    }

    function openDetail(index) {
      const o = window.currentOrderList[index];
      document.getElementById('detailPatientInfo').textContent = `HN: ${o.hn} | ${o.patient_name}`;
      document.getElementById('det-bw').textContent = `${o.bw} kg`;
      document.getElementById('det-totalCalories').textContent = o.total_calories;
      document.getElementById('detailModal').classList.remove('hidden');
    }

    function closeDetail() { document.getElementById('detailModal').classList.add('hidden'); }

    function calculateFatAdmin() {
      const bw = parseFloat(document.getElementById('bw').value) || 0;
      const nF = parseFloat(document.getElementById('netFat').value) || 0;
      const dD = parseInt(document.querySelector('input[name="dripDuration"]:checked').value);
      const fR = (bw * nF) / bw / dD;
      document.getElementById('fatRateValue').textContent = roundToPlace(fR, 4);
    }

    function updateOrderSummary() {
      const hn = document.getElementById('hn').value || '-';
      const name = document.getElementById('patientName').value || '-';
      const bw = document.getElementById('bw').value || '0';
      const cal = document.getElementById('totalCalDisplay').textContent;
      document.getElementById('orderSummary').innerHTML = `
        <div class="grid grid-cols-2 gap-4">
          <p><span class="opacity-70">üè• HN:</span> ${hn}</p>
          <p><span class="opacity-70">‚öñÔ∏è ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å:</span> ${bw} kg</p>
          <p><span class="opacity-70">üë§ ‡∏ä‡∏∑‡πà‡∏≠:</span> ${name}</p>
          <p><span class="opacity-70">üî• ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà:</span> ${cal} kcal/day</p>
        </div>`;
    }

    function resetForm() {
      document.querySelectorAll('input[type="number"], input[type="text"]').forEach(i => i.value = '');
      document.getElementById('orderDate').valueAsDate = new Date();
      calculateAll();
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('orderDate').valueAsDate = new Date();
      calculateAll();
    });
  </script>
</body>
</html>
